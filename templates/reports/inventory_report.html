{% extends 'base.html' %}

{% block title %}Báo cáo tồn kho chi tiết{% endblock %}

{% block content %}
<div class="container py-4" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up">
    <div class="d-flex justify-content-between align-items-center mb-3" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
        <h2 class="mb-0"><i class="fas fa-warehouse brand-icon" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i><span class="brand-gradient"> Báo cáo tồn kho chi tiết</span></h2>
        <a href="{% url 'reports:export_inventory_excel' %}" class="btn btn-outline-success btn-export">
            <i class="fas fa-file-excel" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i> Xuất Excel
        </a>
    </div>
    <div class="row mb-4" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
        <div class="col-md-3" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
            <div class="glass-card text-bg-primary mb-3 glass-card" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="slide-up" data-aos-delay="200">
                <div class="glass-card-body text-center glass-card" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="slide-up" data-aos-delay="200">
                    <h4 class="glass-card-title">{{ total_products }}</h4>
                    <p class="glass-card-text">Tổng sản phẩm</p>
                </div>
            </div>
        </div>
        <div class="col-md-3" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
            <div class="glass-card text-bg-success mb-3 glass-card" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="slide-up" data-aos-delay="200">
                <div class="glass-card-body text-center glass-card" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="slide-up" data-aos-delay="200">
                    <h4 class="glass-card-title">{{ low_stock_products|length }}</h4>
                    <p class="glass-card-text">Sắp hết hàng</p>
                </div>
            </div>
        </div>
        <div class="col-md-3" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
            <div class="glass-card text-bg-danger mb-3 glass-card" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="slide-up" data-aos-delay="200">
                <div class="glass-card-body text-center glass-card" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="slide-up" data-aos-delay="200">
                    <h4 class="glass-card-title">{{ expiring_products|length }}</h4>
                    <p class="glass-card-text">Sắp hết hạn</p>
                </div>
            </div>
        </div>
    </div>
    <div class="table glass-table glass-table-responsive" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
        <table class="table glass-table glass-table table-bordered table-hover align-middle glass-table">
            <thead class="table glass-table glass-table-light">
                <tr data-aos="fade-in" data-aos-delay="500">
                    <th>#</th>
                    <th>Mã SP</th>
                    <th>Tên sản phẩm</th>
                    <th>Danh mục</th>
                    <th>Đơn vị</th>
                    <th>Tổng tồn kho</th>
                    <th>Lô hàng</th>
                    <th>Hạn sử dụng</th>
                    <th>Số lượng còn</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                {% for item in inventory_details %}
                <tr data-aos="fade-in" data-aos-delay="500">
                    <td>{{ forloop.counter }}</td>
                    <td>{{ item.product.code }}</td>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.product.category.name }}</td>
                    <td>{{ item.product.unit }}</td>
                    <td>{{ item.product.total_stock }}</td>
                    <td>{{ item.batch.batch_code }}</td>
                    <td>{{ item.batch.expiry_date|date:'d/m/Y'|default:"-" }}</td>
                    <td>{{ item.batch.remaining_quantity }}</td>
                    <td>
                        {% if item.batch.expiry_date and item.batch.expiry_date < today %}
                            <span class="badge badge-modern badge-modern badge-modern badge-expired">Hết hạn</span>
                        {% elif item.batch.expiry_date and item.batch.expiry_date < expiring_soon %}
                            <span class="badge badge-modern badge-modern badge-modern badge-expiring text-dark">Sắp hết hạn</span>
                        {% elif item.batch.remaining_quantity <= 1 %}
                            <span class="badge badge-modern badge-modern badge-modern badge-expiring text-dark">Sắp hết hàng</span>
                        {% else %}
                            <span class="badge badge-modern badge-modern badge-modern badge-normal">Bình thường</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr data-aos="fade-in" data-aos-delay="500">
                    <td colspan="10" class="text-center text-muted">
                        <i class="fas fa-info-circle" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i> Chưa có dữ liệu tồn kho
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="row mt-4" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
        <div class="col-md-6" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
            <div class="glass-alert alert alert-warning glass-alert" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="fade-in" data-aos-delay="300">
                <strong style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Cảnh báo:</strong> Các sản phẩm/lô hàng sắp hết hạn hoặc sắp hết hàng sẽ được đánh dấu màu vàng hoặc đỏ.
            </div>
        </div>
        <div class="col-md-6" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200">
            <div class="glass-alert alert alert-info glass-alert" data-aos="fade-up" data-aos-delay="200" data-aos="fade-up" data-aos-delay="200" data-aos="fade-in" data-aos-delay="300">
                <strong style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Ghi chú:</strong> Báo cáo này tổng hợp tồn kho theo từng lô hàng, giúp kiểm soát hạn dùng và số lượng tồn thực tế.
            </div>
        </div>
    </div>
</div>
{% endblock %} 